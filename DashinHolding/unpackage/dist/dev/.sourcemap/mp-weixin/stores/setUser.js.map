{"version":3,"file":"setUser.js","sources":["stores/setUser.js"],"sourcesContent":["import {ref} from 'vue'\r\nimport {ip} from \"@/stores/ipconfig\";\r\nimport {useLogin} from \"@/stores/useLogin\";\r\n\r\nconst {cookesUser, getUserInfo} = useLogin()\r\n\r\nconst images = ref('')\r\n\r\n// 选多图并上传\r\nfunction chooseImages() {\r\n    uni.chooseImage({\r\n        count: 1,\r\n        sizeType: ['compressed'],\r\n        success: chooseRes => {\r\n            const paths = chooseRes.tempFilePaths;\r\n            const uploadTasks = paths.map(p => new Promise((resolve, reject) => {\r\n                uni.uploadFile({\r\n                    url: ip + '/app/upload',\r\n                    filePath: p,\r\n                    name: 'files',\r\n                    formData: {},\r\n                    success: uRes => {\r\n                        try {\r\n                            const json = JSON.parse(uRes.data);\r\n                            if (json.success) {\r\n                                resolve(json.data)\r\n                            } else {\r\n                                reject(json)\r\n                            }\r\n                        } catch (err) {\r\n                            reject(err);\r\n                        }\r\n                    },\r\n                    fail: reject\r\n                });\r\n            }));\r\n\r\n            // 并行上传所有选中的\r\n            Promise.all(uploadTasks)\r\n                .then(results => {\r\n                    // results 是多个[ {filename,url}, ... ]\r\n                    // 合并到 images\r\n                    results.flat().forEach(img => {\r\n                        images.value = ip + '/uploads/' + img.url\r\n                    });\r\n                    set(images.value)\r\n                    uni.showToast({title: '修改成功', icon: 'success'});\r\n                })\r\n                .catch(err => {\r\n                    console.error('上传错误', err);\r\n                    uni.showToast({title: '上传失败', icon: 'none'});\r\n                });\r\n        }\r\n    });\r\n}\r\n\r\n//封装一个post请求\r\nasync function getRegisterCode(data) {\r\n    return await uni.request({\r\n        url: ip + '/app/setAvatar',\r\n        method: 'GET',\r\n        data\r\n    });\r\n}\r\n\r\nasync function set(img) {\r\n    const res = await getRegisterCode({\r\n        price: img,\r\n        id: cookesUser.value.id\r\n    })\r\n    uni.setStorageSync('user', res.data.data[0]);\r\n    getUserInfo();\r\n}\r\n\r\n/*xiu==================================*/\r\n//修改名称\r\nconst inpName = ref(cookesUser.value.username);\r\n\r\nasync function setNameData(data) {\r\n    return await uni.request({\r\n        url: ip + '/app/setName',\r\n        method: 'GET',\r\n        data\r\n    });\r\n}\r\n\r\nasync function setName() {\r\n    const res = await setNameData({\r\n        price: inpName.value,\r\n        id: cookesUser.value.id\r\n    })\r\n    if (res.data.code === 200) {\r\n        uni.setStorageSync('user', res.data.data[0]);\r\n        getUserInfo();\r\n        uni.showToast({title: '修改成功', icon: 'success'});\r\n    }\r\n}\r\n\r\n/*======================================================*/\r\n\r\n//修改性别\r\nasync function setSexData(data) {\r\n    return await uni.request({\r\n        url: ip + '/app/setSex',\r\n        method: 'GET',\r\n        data\r\n    });\r\n}\r\n\r\nasync function setSex(sex) {\r\n    const res = await setSexData({\r\n        price: sex,\r\n        id: cookesUser.value.id\r\n    })\r\n    if (res.data.code === 200) {\r\n        uni.setStorageSync('user', res.data.data[0]);\r\n        getUserInfo();\r\n        uni.showToast({title: '修改成功', icon: 'success'});\r\n    }\r\n}\r\n\r\n/*======================================================*/\r\n\r\n/*======================================================*/\r\nconst inpEmail = ref(cookesUser.value.email == '' ? '未填写' : cookesUser.value.email)\r\n\r\n//修改邮箱地址\r\nasync function setEmailData(data) {\r\n    return await uni.request({\r\n        url: ip + '/app/setEmail',\r\n        method: 'GET',\r\n        data\r\n    });\r\n}\r\n\r\nasync function setEmail() {\r\n    const res = await setEmailData({\r\n        price: inpEmail.value,\r\n        id: cookesUser.value.id\r\n    })\r\n    if (res.data.code === 200) {\r\n        uni.setStorageSync('user', res.data.data[0]);\r\n        getUserInfo();\r\n        uni.showToast({title: '修改成功', icon: 'success'});\r\n    }\r\n}\r\n\r\n/*======================================================*/\r\n\r\n/*======================================================*/\r\n//修改手机号\r\nconst inpPhone = ref(cookesUser.value.phone)\r\n\r\nasync function setPhoneData(data) {\r\n    return await uni.request({\r\n        url: ip + '/app/setPhone',\r\n        method: 'GET',\r\n        data\r\n    });\r\n}\r\n\r\nasync function setPhone() {\r\n    const res = await setPhoneData({\r\n        price: inpPhone.value,\r\n        id: cookesUser.value.id\r\n    })\r\n    if (res.data.code === 200) {\r\n        uni.setStorageSync('user', res.data.data[0]);\r\n        getUserInfo();\r\n        uni.showToast({title: '修改成功', icon: 'success'});\r\n    }\r\n}\r\n\r\n/*======================================================*/\r\n\r\n/*======================================================*/\r\n\r\n//修改教师认证编号，（输入的值先和后端数据库进行比对，如果数据库没有改认证数据表就直接提示）\r\nconst inpTeacher = ref(cookesUser.value.teacher)\r\n\r\nasync function setTeacherData(data) {\r\n    return await uni.request({\r\n        url: ip + '/app/setTeacher',\r\n        method: 'GET',\r\n        data\r\n    });\r\n}\r\n\r\nasync function setTeacher() {\r\n    const res = await setTeacherData({\r\n        price: inpTeacher.value,\r\n        id: cookesUser.value.id\r\n    })\r\n\t\tconsole.log(res.data)\r\n    if (res.data.code === 200) {\r\n        uni.setStorageSync('user', res.data.data[0]);\r\n        getUserInfo();\r\n        uni.showToast({title: '修改成功', icon: 'success'});\r\n    }\r\n}\r\n\r\nexport function SetUser() {\r\n    return {\r\n        chooseImages,\r\n        set,\r\n        inpName,\r\n        setName,\r\n        setSex,\r\n        inpEmail,\r\n        setEmail,\r\n        inpPhone,\r\n        setPhone,\r\n        inpTeacher,\r\n        setTeacher\r\n    }\r\n}"],"names":["useLogin","ref","uni","ip"],"mappings":"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"}