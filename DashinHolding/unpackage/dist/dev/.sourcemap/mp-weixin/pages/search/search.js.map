{"version":3,"file":"search.js","sources":["pages/search/search.vue","../../../../Downloads/HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2VhcmNoL3NlYXJjaC52dWU"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <button @click=\"chooseImages\">选择图片（最多9张）</button>\n    <view style=\"display: flex;flex-wrap: wrap;\">\n      <view class=\"thumbs\" v-for=\"(item, idx) in images\" :key=\"item.filename\">\n        <image\n            :src=\"ip + '/uploads/' + item\"\n            mode=\"heightFix\"\n            class=\"thumb\"\n            @click=\"previewImage(idx)\"\n        />\n        <button @click.stop=\"deleteImage(item, idx)\" class=\"del-btn\">删除</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport {ref, onMounted} from 'vue';\nimport {onShow} from \"@dcloudio/vue-cli-plugin-uni/packages/uni-app\";\n\nconst images = ref([]);\nimport {ip} from \"@/stores/ipconfig\";\n\n// 拉取当前已上传的列表\nasync function fetchImages() {\n  try {\n    const res = await uni.request({\n      url: ip + '/app/images',\n    });\n    console.log(res.data)\n    images.value = res.data;\n    console.log(images.value)\n  } catch (e) {\n    console.error('获取列表失败', e);\n  }\n}\n\n// 选多图并上传\nfunction chooseImages() {\n  uni.chooseImage({\n    count: 9,\n    sizeType: ['compressed'],\n    success: chooseRes => {\n      const paths = chooseRes.tempFilePaths;\n      const uploadTasks = paths.map(p => new Promise((resolve, reject) => {\n        uni.uploadFile({\n          url: ip + '/app/upload',\n          filePath: p,\n          name: 'files',\n          formData: {},\n          success: uRes => {\n            try {\n              const json = JSON.parse(uRes.data);\n              if (json.success) {\n                resolve(json.data)\n              } else {\n                reject(json)\n              }\n            } catch (err) {\n              reject(err);\n            }\n          },\n          fail: reject\n        });\n      }));\n\n      // 并行上传所有选中的\n      Promise.all(uploadTasks)\n          .then(results => {\n            // results 是多个[ {filename,url}, ... ]\n            // 合并到 images\n            results.flat().forEach(img => {\n              images.value.push(img.url)\n              console.log(img.url)\n            });\n            uni.showToast({title: '全部上传完成', icon: 'success'});\n          })\n          .catch(err => {\n            console.error('上传错误', err);\n            uni.showToast({title: '上传失败', icon: 'none'});\n          });\n    }\n  });\n}\n\n// 删除\nfunction deleteImage(filename, idx) {\n  uni.request({\n    url: ip + `/app/images/${filename}`,\n    method: 'DELETE',\n    success: (res) => {\n      // 这里只有一个参数 res\n      // 并不是 (err, response)\n      console.log('raw response:', res)\n      const json = res.data\n      if (json.success) {\n        images.value.splice(idx, 1)\n        uni.showToast({title: '删除成功', icon: 'success'})\n      } else {\n        uni.showToast({title: '删除失败', icon: 'none'})\n      }\n    },\n    fail: (err) => {\n      console.error('删除请求出错', err)\n      uni.showToast({title: '删除出错', icon: 'none'})\n    }\n  })\n\n}\n\n// 新增预览功能\nfunction previewImage(currentIndex) {\n  // 生成完整的图片URL数组\n  const urls = images.value.map(item => ip + '/uploads/' + item);\n\n  uni.previewImage({\n    current: currentIndex,       // 当前显示图片的索引\n    urls: urls,                 // 所有需要预览的图片URL列表\n    indicator: 'default',       // 显示指示器\n    loop: true                  // 支持循环预览\n  });\n}\n\nonMounted(fetchImages);\nonShow(()=>{\n  fetchImages()\n})\n</script>\n\n<style>\n.container {\n  padding-top: 120px;\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.thumbs {\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 10px;\n  position: relative;\n}\n\n.thumb {\n  width: 100px;\n  height: 100px;\n  margin: 5px;\n}\n\n.del-btn {\n  position: absolute;\n  margin-top: -20px;\n  margin-left: 80px;\n  font-size: 12px;\n}\n\n.container {\n  padding-top: 120px;\n  display: flex;\n  flex-wrap: wrap;\n}\n\n.thumbs {\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 10px;\n  position: relative;\n}\n\n.thumb {\n  width: 100px;\n  height: 100px;\n  margin: 5px;\n}\n\n.del-btn {\n  position: absolute;\n  margin-top: -20px;\n  margin-left: 80px;\n  font-size: 12px;\n}\n\n.thumb {\n  cursor: pointer;\n  transition: opacity 0.3s;\n}\n\n.thumb:active {\n  opacity: 0.7;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/marex/Documents/web/Marex-APP/DashinHolding/pages/search/search.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","ip","onMounted","onShow","MiniProgramPage"],"mappings":"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"}